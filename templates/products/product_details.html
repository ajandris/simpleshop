{% extends '_base.html' %}
{% load static %}

{% block extra_js %}
    <script>
    const GALLERY =[];
    </script>
{% endblock %}


{% block content %}
  <div class="w3-border-bottom" >
    <h3 class="w3-center wide">{{ product.title }}</h3>
  </div>

  <div class="w3-padding-16">

    <div class="w3-row-padding">
      <!-- LEFT: Gallery -->
      <div class="w3-col l6 m12 s12">
        <div class="w3-card w3-white w3-padding">

          <!-- Main Image (zoomable) -->
          <div class="main-figure">
            <div id="zoomStage"
                 class="zoom-stage"
                 role="img"
                 aria-label="{{ product.title }}">
            </div>
          </div>

          <!-- Thumbnails with scroll + arrows -->
          {% if gallery %}
          <div class="thumbs-wrap w3-margin-top">
            <button type="button" class="w3-button w3-white w3-border thumb-btn thumb-btn-left"
                    aria-label="Previous images" id="thumbs_left_btn">
              <i class="fa-solid fa-chevron-left background-color-inherit"></i>
            </button>

            <div id="thumbs" class="thumbs">
              {% for url in gallery %}
              <div class="thumb" data-index="{{ forloop.counter0 }}">
                <img id='img_{{ forloop.counter }}' src="{{ url }}" alt="{{ product.title }} thumbnail {{ forloop.counter }}">
              </div>
                  <script>
                  GALLERY.push('{{ url }}')
                  </script>
              {% endfor %}
            </div>

            <button type="button" class="w3-button w3-white w3-border thumb-btn
                    thumb-btn-right"
                    aria-label="Next images" id="thumbs_right_btn">
              <i class="fa-solid fa-chevron-right background-color-inherit"></i>
            </button>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- RIGHT: Details + purchase -->
      <div class="w3-col l6 m12 s12">
        <div class="w3-card w3-white w3-padding">
          <h2 class="w3-margin-top w3-margin-bottom">{{ product.title }}</h2>
          <div class="price">£{{ product.price }}</div>

          {% if product.category %}
            <div class="w3-small w3-text-grey w3-margin-top">{{ product.category.name }}</div>
          {% endif %}

          {% if product.description %}
            <div class="w3-section desc">{{ product.description|safe }}</div>
          {% endif %}

          <form method="post" action="{% url 'add-to-cart' %}" class="w3-section">
            {% csrf_token %}
              <input type="hidden" name="sku" value="{{ product.sku }}">
            <label class="w3-small">Quantity</label>
            <input class="w3-input w3-border w3-round qty-input" type="number" name="quantity"
                   min="1" value="1" required>

            <div class="w3-section">
              <button class="w3-button w3-black w3-round w3-margin-right" type="submit">
                <i class="fa-solid fa-cart-plus background-color-inherit"></i> Add to cart
              </button>

              <button formaction="{% url 'pay-now' %}"
                      class="w3-button w3-red w3-round" type="submit">
                <i class="fa-solid fa-bolt background-color-inherit"></i> Pay now
              </button>
            </div>
          </form>

          <div class="w3-small w3-text-grey">
            <i class="fa-solid fa-truck-fast"></i> Free delivery over £50 •
            <i class="fa-solid fa-rotate"></i> 30-day returns
          </div>
        </div>
      </div>
    </div>
    <div id="active_image" data-active-image-id = "0"></div>
  </div>

{% endblock content %}

{% block postloadjs %}
        <script src="{% static 'js/product_gallery.js' %}"></script>
{% endblock postloadjs %}